pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                script {
                    def dotnetInstallation = tool name: 'dotnet', type: 'hudson.plugins.dotnet.DotNetToolInstallation'
                    // Use 'dotnet' tool
                    withEnv(["PATH+DOTNET=${dotnetInstallation}/bin"]){ 
                        sh 'dotnet build'
                    }
                }
            }
        }
        stage('SonarQube Analysis') {
            steps {
                script {
                    def dotnetInstallation = tool name: 'dotnet', type: 'hudson.plugins.dotnet.DotNetToolInstallation'
                    // Use 'dotnet' tool
                    withEnv(["PATH+DOTNET=${dotnetInstallation}/bin"]){ 
                        sh "dotnet ${tool name: 'dotnet', type: 'hudson.plugins.dotnet.DotNetToolInstallation'}/dotnet-sonarscanner begin /k:\".net-code\""
                    }
                }
            }
        }
    }
}
